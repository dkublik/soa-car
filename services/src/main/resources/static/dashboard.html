<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script type="text/javascript">
window.onload = function () {

	var throttleChart = createChart("throttleC", "Throttle")
	var appChart = createChart("appC", "Acc Pedal Position")
	var ctsChart = createChart("ctsC", "Coolant Temperature")
	var mapChart = createChart("mapC", "Manifold Pressure")
	var rpmChart = createChart("rpmC", "RPM")
	var vssChart = createChart("vssC", "Speed")
	var gearChart = createChart("gearC", "gear")

	function createChart(element, title) {
		var chart = new CanvasJS.Chart(element, { 
			title: {
				text: title
			},
			data: [
			{
				type: "spline",
				dataPoints: [
					{ y: 0 },
					{ y: 0 },
					{ y: 0 },
					{ y: 0 }	
				]
			}
			]
		});
		chart.render();
		return chart;
	}
	
	function updateChart(chart, value) {
		chart.options.data[0].dataPoints.push({ y: value});
		var length = chart.options.data[0].dataPoints.length;
		chart.render();
	}
	

	
	function updateAll() {
		$.getJSON( "ecu/throttle", function( data ) {
			updateChart(throttleChart, data.level);
		});
		$.getJSON( "/sensors/app", function( data ) {
			updateChart(appChart, data.pedalPosition);
		});
		$.getJSON( "/sensors/cts", function( data ) {
			updateChart(ctsChart, data.temperature);
		});
		$.getJSON( "/sensors/map", function( data ) {
			updateChart(mapChart, data.pressure);
		});
		$.getJSON( "/sensors/rpm", function( data ) {
			updateChart(rpmChart, data.rpm);
		});
		$.getJSON( "/sensors/vss", function( data ) {
			updateChart(vssChart, data.speed);
		});
		$.getJSON( "/tcu/current-gear", function( data ) {
			updateChart(gearChart, data.currentGear);
		});
	}
	
	setInterval(updateAll, 1000);

}
</script>
</head>
<body>
<div id="throttleC" style="width:400px; height:280px;display:inline-block"></div>
<div id="appC" style="width:400px; height:280px;display:inline-block" ></div>
<div id="ctsC" style="width:400px; height:280px;display:inline-block"></div>
<div id="mapC" style="width:400px; height:280px;display:inline-block"></div>
<div id="rpmC" style="width:400px; height:280px;display:inline-block" ></div>
<div id="vssC" style="width:400px; height:280px;display:inline-block" ></div>
<div id="gearC" style="width:400px; height:280px;display:inline-block"></div>
</body>
</html>
